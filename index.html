<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>گالری طلا شروین - قیمت لحظه‌ای</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', Tahoma, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        
        .container {
            max-width: 450px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .logo-container {
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        
        .brand-logo {
            width: 280px;
            height: auto;
            margin-bottom: -25px;
            display: flex;
            justify-content: center;
        }
        
        .brand-logo img {
            width: 100%;
            height: auto;
            max-width: 100%;
            border: none;
            background: transparent;
            box-shadow: none;
            border-radius: 0;
        }
        
        .logo-text {
            text-align: center;
            width: 100%;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: #85d0cb;
            font-weight: 700;
            letter-spacing: -0.5px;
            line-height: 1.3;
        }
        
        .logo p {
            font-size: 0.9rem;
            opacity: 0.8;
            font-weight: 400;
            line-height: 1.2;
        }
        
        .links {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 0px;
            width: 100%;
            max-width: 100%;
            align-items: center;
        }
        
        .link-button,
        .price-button {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: rgba(133, 208, 203, 0.15);
            color: #fff;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(133, 208, 203, 0.2);
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 450px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        .link-button:hover,
        .price-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(133, 208, 203, 0.15);
            border: 1px solid rgba(133, 208, 203, 0.3);
            background: rgba(133, 208, 203, 0.25);
        }
        
        .link-button i,
        .price-button i {
            font-size: 1.2rem;
            color: #85d0cb;
            flex-shrink: 0;
            margin-left: 10px;
            order: 1;
        }
        
        .link-button span,
        .price-button span {
            flex: 1;
            text-align: center;
            order: 2;
        }
        
        #priceIndicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            flex-shrink: 0;
            order: 3;
        }
        
        .live-indicator {
            background: #f44336;
            animation: pulse 2s infinite;
            box-shadow: 0 0 8px rgba(244, 67, 54, 0.6);
        }
        
        .offline-indicator {
            background: #b0b0b0;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.15); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .price-section {
            width: 100%;
            max-width: 100%;
            margin: 10px 0;
        }
        
        .price-panel {
            background: rgba(133, 208, 203, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(133, 208, 203, 0.2);
            border-radius: 14px;
            padding: 16px;
            margin-top: 12px;
            display: none;
            width: 100%;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .price-panel.active {
            display: block;
        }
        
        .price-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
            color: #85d0cb;
        }
        
        .price-header i {
            font-size: 1.2rem;
        }
        
        .price-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .price-category {
            margin-bottom: 20px;
        }
        
        .category-title {
            color: #85d0cb;
            font-size: 1rem;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(133, 208, 203, 0.3);
        }
        
        .price-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
        }
        
        .price-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .price-label {
            font-weight: 500;
            color: #e0e0e0;
            font-size: 0.85rem;
        }
        
        .price-value {
            font-weight: 600;
            direction: ltr;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            text-align: left;
            min-width: 80px;
        }
        
        .price-arrow {
            font-size: 0.8rem;
        }
        
        .up { color: #4caf50; }
        .down { color: #f44336; }
        .neutral { color: #b0b0b0; }
        
        .price-time {
            text-align: center;
            margin-top: 16px;
            font-size: 0.75rem;
            color: #85d0cb;
            font-weight: 500;
            line-height: 1.3;
        }
        
        .time-status {
            text-align: center;
            margin-top: 6px;
            font-size: 0.65rem;
            opacity: 0.8;
            color: #85d0cb;
        }
        
        .loading {
            text-align: center;
            padding: 16px;
            color: #85d0cb;
        }
        
        .error {
            text-align: center;
            padding: 16px;
            color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 8px;
            margin: 8px 0;
        }
        
        .footer {
            margin-top: 30px;
            font-size: 0.75rem;
            opacity: 0.6;
            font-weight: 300;
            text-align: center;
            width: 100%;
            background: transparent !important;
            color: #fff !important;
            padding: 0 10px;
        }
        
        .bg-glow {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, rgba(133, 208, 203, 0.1) 0%, rgba(133, 208, 203, 0) 70%);
            z-index: -1;
            pointer-events: none;
        }

        /* ==== ریسپانسیو موبایل - بهینه‌شده ==== */
        @media (max-width: 480px) {
            body {
                padding: 15px;
                justify-content: flex-start;
                padding-top: 20px;
            }
            
            .container { 
                padding: 0;
                max-width: 100%;
            }
            
            .logo-container {
                margin-bottom: 25px;
            }
            
            .brand-logo { 
                width: 220px; 
                margin-bottom: -30px;
            }
            
            .logo h1 {
                font-size: 1.5rem;
                margin-bottom: 4px;
            }
            
            .logo p {
                font-size: 0.85rem;
            }
            
            .links {
                gap: 10px;
                margin-top: 0;
                align-items: center;
            }
            
            .link-button, 
            .price-button {
                padding: 12px 18px;
                font-size: 0.92rem;
                border-radius: 10px;
                min-height: 48px;
                width: 90%;
                max-width: 380px;
                justify-content: space-between;
                gap: 12px;
                display: flex;
                align-items: center;
            }
            
            .link-button i, 
            .price-button i {
                font-size: 1.1rem;
                margin: 0;
                order: 1;
            }
            
            .link-button span,
            .price-button span {
                flex: 1;
                text-align: center;
                margin: 0;
                order: 2;
            }
            
            #priceIndicator {
                margin: 0;
                order: 3;
            }
            
            .price-panel { 
                padding: 14px; 
                margin-top: 10px;
                border-radius: 12px;
                max-width: 380px;
                width: 90%;
                margin-left: auto;
                margin-right: auto;
            }
            
            .price-item { 
                padding: 8px 10px; 
            }
            
            .price-label, 
            .price-value { 
                font-size: 0.8rem; 
            }
            
            .price-header h3 {
                font-size: 1rem;
            }
            
            .category-title {
                font-size: 0.9rem;
            }
            
            .price-value {
                min-width: 70px;
            }
        }

        @media (max-width: 360px) {
            .brand-logo {
                width: 190px;
                margin-bottom: -28px;
            }
            
            .logo h1 {
                font-size: 1.35rem;
            }
            
            .logo p {
                font-size: 0.8rem;
            }
            
            .link-button, 
            .price-button {
                padding: 11px 16px;
                font-size: 0.88rem;
                min-height: 44px;
                gap: 10px;
                max-width: 340px;
                width: 92%;
            }
            
            .link-button i, 
            .price-button i {
                font-size: 1rem;
            }
        }

        @media (max-width: 320px) {
            .brand-logo { 
                width: 170px; 
                margin-bottom: -25px;
            }
            
            .logo h1 {
                font-size: 1.25rem;
            }
            
            .link-button, 
            .price-button { 
                padding: 10px 14px; 
                font-size: 0.85rem;
                gap: 8px;
                max-width: 300px;
                width: 94%;
            }
            
            .price-value {
                min-width: 60px;
                font-size: 0.75rem;
            }
            
            .price-label {
                font-size: 0.75rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="bg-glow"></div>
    
    <div class="container">
        <div class="logo-container">
            <div class="brand-logo">
                <img src="https://s6.uupload.ir/files/hia_copy_zd8w.png" alt="گالری طلا شروین">
            </div>
            <div class="logo">
                <div class="logo-text">
                    <h1>گالری طلا شروین</h1>
                    <p>قیمت لحظه‌ای طلا و سکه</p>
                </div>
            </div>
        </div>
        
        <!-- ==== دکمه‌ها و پنل قیمت ==== -->
        <div class="links">
            <!-- دکمه قیمت لحظه‌ای - مستقیم زیر links -->
            <div class="price-button" onclick="togglePricePanel()">
                <i class="fas fa-chart-line"></i>
                <span>قیمت لحظه‌ای</span>
                <div id="priceIndicator" class="live-indicator"></div>
            </div>

            <!-- پنل قیمت - داخل price-section -->
            <div class="price-section">
                <div class="price-panel" id="pricePanel">
                    <div class="price-header">
                        <i class="fas fa-coins"></i>
                        <h3>قیمت‌های لحظه‌ای</h3>
                    </div>
                    
                    <div id="priceContainer">
                        <div class="loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>در حال دریافت قیمت‌ها...</p>
                        </div>
                    </div>
                    
                    <div class="price-time">
                        <span id="updateTime">آخرین بروزرسانی: -</span>
                    </div>
                    <div class="time-status">
                        <span id="timeStatus">وضعیت: بررسی زمان...</span>
                    </div>
                </div>
            </div>
            
            <!-- بقیه دکمه‌ها -->
            <a href="https://maps.app.goo.gl/yXq4s3RH57QH6VCB9" class="link-button" target="_blank">
                <i class="fas fa-map-marker-alt"></i>
                <span>آدرس گالری</span>
            </a>
            
            <a href="https://instagram.com/shervin.goldgallery" class="link-button" target="_blank">
                <i class="fab fa-instagram"></i>
                <span>اینستاگرام</span>
            </a>
            
            <a href="https://wa.me/989367499217" class="link-button" target="_blank">
                <i class="fab fa-whatsapp"></i>
                <span>ثبت سفارش</span>
            </a>
        </div>
        
        <div class="footer">
            <p>© 2025 گالری طلا شروین / طراح امیرجهانی. تمامی حقوق محفوظ است.</p>
        </div>
    </div>

    <script>
        const API_URL = "https://BrsApi.ir/Api/Market/Gold_Currency.php?key=FreeE4uMPdiKOdaCSkCF5AsR7Qw1kh4w";
        let pricePanelVisible = false;
        let apiCallCount = 0;
        let lastApiCallDate = null;
        let lastUpdateTime = null;
        let isActiveTime = false;
        let cachedPrices = null;

        function toPersianNumbers(num) {
            const persianNumbers = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
            return num.toString().replace(/\d/g, function(match) {
                return persianNumbers[parseInt(match)];
            });
        }

        function toJalaliDate(date) {
            if (!date || isNaN(date)) return 'ندارد';
            const options = { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZone: 'Asia/Tehran'
            };
            const parts = date.toLocaleDateString('fa-IR', options).split(' ');
            const day = parts[0];
            const month = parts[1];
            const year = parts[2];
            const time = date.toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' });
            return `${day} ${month} ${year} - ${time}`;
        }

        function getTehranTime() {
            return new Date();
        }

        function checkActiveTime() {
            const tehranTime = getTehranTime();
            const hour = tehranTime.getHours();
            const minute = tehranTime.getMinutes();
            const currentTime = hour + minute / 60;
            isActiveTime = (currentTime >= 11 && currentTime < 20);
            updateTimeStatus();
            return isActiveTime;
        }

        function updateTimeStatus() {
            const statusElement = document.getElementById('timeStatus');
            const indicator = document.getElementById('priceIndicator');
            
            if (isActiveTime) {
                statusElement.innerHTML = `آنلاین - در حال به‌روزرسانی خودکار`;
                indicator.className = 'live-indicator';
            } else {
                statusElement.innerHTML = `آخرین قیمت‌ها تا ساعت ۲۰:۰۰ امروز`;
                indicator.className = 'offline-indicator';
            }
        }

        function loadCachedPrices() {
            const cached = localStorage.getItem('cachedGoldPrices');
            if (cached) {
                const data = JSON.parse(cached);
                const cacheTime = new Date(data.timestamp);
                const now = new Date();
                const cacheHour = cacheTime.getHours();
                const currentHour = now.getHours();
                const cacheDate = cacheTime.toDateString();
                const currentDate = now.toDateString();

                if (cacheDate === currentDate && cacheHour >= 11) return true;
                if (cacheDate !== currentDate && currentHour < 11) return true;
            }
            return false;
        }

        function savePricesToCache(prices) {
            const cacheData = { prices, timestamp: new Date().getTime() };
            localStorage.setItem('cachedGoldPrices', JSON.stringify(cacheData));
            cachedPrices = cacheData;
        }

        function initializeApiCounter() {
            const today = new Date().toDateString();
            const stored = localStorage.getItem('apiUsage');
            if (stored) {
                const data = JSON.parse(stored);
                if (data.date === today) apiCallCount = data.count;
            }
            lastApiCallDate = today;
        }

        function incrementApiCounter() {
            const today = new Date().toDateString();
            if (lastApiCallDate !== today) { apiCallCount = 0; lastApiCallDate = today; }
            apiCallCount++;
            localStorage.setItem('apiUsage', JSON.stringify({ date: today, count: apiCallCount }));
        }

        function formatPrice(price) {
            if (!price) return '۰';
            return new Intl.NumberFormat('fa-IR').format(Math.round(String(price).replace(/,/g, '')));
        }

        function formatOuncePrice(price) {
            if (!price) return '۰';
            const rawNumber = Math.round(String(price).replace(/,/g, '')).toString();
            return toPersianNumbers(rawNumber);
        }

        function getArrowFromChange(changePercent) {
            if (!changePercent) return { symbol: '●', class: 'neutral' };
            if (changePercent > 0) return { symbol: '▲', class: 'up' };
            if (changePercent < 0) return { symbol: '▼', class: 'down' };
            return { symbol: '●', class: 'neutral' };
        }

        function togglePricePanel() {
            const panel = document.getElementById('pricePanel');
            pricePanelVisible = !pricePanelVisible;
            if (pricePanelVisible) { panel.classList.add('active'); loadPrices(); }
            else panel.classList.remove('active');
        }

        async function fetchGoldPrices() {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error(`خطا: ${response.status}`);
            const data = await response.json();
            incrementApiCounter();
            return data;
        }

        function displayGoldPrices(data) {
            if (!data || !data.gold) throw new Error('داده‌های طلا یافت نشد');
            const goldItems = data.gold;
            const currencyItems = data.currency || [];
            let html = '';

            html += `<div class="price-category"><div class="category-title">طلا و سکه</div><div class="price-grid">`;

            const desiredOrder = ['انس طلا','طلای 18 عیار','سکه امامی','سکه بهار آزادی','نیم سکه','ربع سکه','سکه یک گرمی'];
            const sortedItems = [];
            desiredOrder.forEach(name => {
                const item = goldItems.find(i => (i.name || '').includes(name));
                if (item) sortedItems.push(item);
            });
            const itemsToShow = sortedItems.length > 0 ? sortedItems : goldItems.slice(0, 7);

            itemsToShow.forEach(item => {
                const arrow = getArrowFromChange(item.change_percent);
                let name = item.name || 'نامشخص';
                let price, unit = '';
                
                if (name.includes('انس طلا')) {
                    name = 'انس طلا';
                    price = formatOuncePrice(item.price);
                    unit = '';
                } else {
                    price = formatPrice(item.price);
                    unit = item.unit || '';
                }
                
                html += `<div class="price-item"><span class="price-label">${name}</span><div class="price-value"><span class="price-arrow ${arrow.class}">${arrow.symbol}</span>${price} ${unit}</div></div>`;
            });

            html += `</div></div>`;

            const dollarItem = currencyItems.find(i => (i.name || '').includes('دلار') || (i.name || '').includes('USD'));
            if (dollarItem) {
                const arrow = getArrowFromChange(dollarItem.change_percent);
                const price = formatPrice(dollarItem.price);
                const unit = dollarItem.unit || '';
                html += `<div class="price-category"><div class="category-title">ارز</div><div class="price-grid"><div class="price-item"><span class="price-label">دلار آمریکا</span><div class="price-value"><span class="price-arrow ${arrow.class}">${arrow.symbol}</span>${price} ${unit}</div></div></div></div>`;
            }

            return html;
        }

        function displayPrices(data, isCached = false) {
            const container = document.getElementById('priceContainer');
            const now = getTehranTime();
            if (!isCached) { lastUpdateTime = now; savePricesToCache(data); }

            try {
                container.innerHTML = displayGoldPrices(data);
                const updateDate = isCached && cachedPrices ? new Date(cachedPrices.timestamp) : now;
                document.getElementById('updateTime').textContent = 
                    `آخرین بروزرسانی: ${updateDate ? toJalaliDate(updateDate) : 'ندارد'}`;
            } catch (error) {
                container.innerHTML = `<div class="error"><i class="fas fa-exclamation-triangle"></i><p>${error.message}</p></div>`;
            }
        }

        async function loadPrices() {
            const container = document.getElementById('priceContainer');
            if (apiCallCount >= 1500) { 
                container.innerHTML = `<div class="error"><p>محدودیت درخواست روزانه به پایان رسیده</p></div>`; 
                return; 
            }

            checkActiveTime();

            if (isActiveTime) {
                try {
                    const data = await fetchGoldPrices();
                    displayPrices(data, false);
                } catch {
                    if (loadCachedPrices() && cachedPrices) displayPrices(cachedPrices.prices, true);
                    else displayError('خطا در دریافت قیمت‌ها');
                }
            } else {
                if (loadCachedPrices() && cachedPrices) {
                    displayPrices(cachedPrices.prices, true);
                } else {
                    container.innerHTML = `
                        <div style="background:transparent;border:none;color:#85d0cb;padding:15px 0;text-align:center;">
                            <i class="far fa-clock" style="font-size:1.5rem;margin-bottom:10px;"></i>
                            <p style="margin:8px 0;font-size:0.9rem;">هنوز قیمتی برای امروز ثبت نشده است</p>
                            <p style="font-size:0.75rem;opacity:0.8;">به‌روزرسانی از ساعت ۱۱:۰۰ صبح آغاز می‌شود</p>
                        </div>`;
                    document.getElementById('updateTime').textContent = 'آخرین بروزرسانی: ندارد';
                    document.getElementById('timeStatus').innerHTML = `در انتظار آغاز ساعات کاری`;
                }
            }
        }

        function displayError(message) {
            document.getElementById('priceContainer').innerHTML = `
                <div class="error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>${message}</p>
                    <button onclick="loadPrices()" style="background:#85d0cb;color:#000;border:none;padding:8px 16px;border-radius:6px;margin-top:10px;cursor:pointer;font-family:'Vazirmatn';">تلاش مجدد</button>
                </div>`;
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeApiCounter();
            loadCachedPrices();
            checkActiveTime();

            setInterval(() => { if (pricePanelVisible) loadPrices(); }, 60000);
            setInterval(initializeApiCounter, 3600000);
            setInterval(checkActiveTime, 30000);
        });
    </script>
</body>
</html>
